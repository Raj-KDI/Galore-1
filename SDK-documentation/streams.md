# Streams

Many timeseries databases and systems has a strict separation between historical and realtimedata and provide very different abstraction for accessing them. Galore is useing a stream abstraction to allow access to both realtime and historical data in the same way.

A stream can be compared to a pipe whith some continus flow of some medium often a fluid. The Galore streams does not have a flow of a continuous medioum of course but rather discrete items called events. The events have different types related to which type of stream they belong to. But all events have a utc timestamp set as close to the orign of the event as possible.

The galore streams have certain properties

    -They are stricly ordered by timestamp (this can be  violated by some types of aggregate streams)

    -Event timestamps are unique for most stream types (this can be  violated by some types of streams)

    -They are strongly typed

    -The can contain history, but some are realtime only

When data is ingested into galore, the individual events are dispatched to their respective streams depending on their source identifier, either an "external id" identifying the sensor or device producing the measurement or event, or a galore spesific stream id or path in the asset model.

This streams are often called the "raw data" streams. Each raw data stream is associeted with a set of metadata describing the stream. The raw data stream is always associated with a single node in the asset model.

There are three types of raw data streams:

    - Vector event streams. The events in a vector stream is a timestamp and a vector (array) of floating point values. The vector can have 1 or more elemements. The vector usually represent a measurement or a calculated value. The metadata contains a descripor for each element with fields such as display-name and engineering unit.

    - State event stream. The state event stream is intended for recording state transition event from a state machine. It has fields for the current and previous state, the timestamp for the last 2 transition and attributes (key,value lists). Typically it is used for external alarm and events, and alarm and events generated by the calculator service. The two timestamp fields makes it very easy to visualize states as waterfall or timeline diagrams. The stream and its events has a type field which allows it to be associated with its state descriptiors.

    - Sampleset event streams. The events in a sampleset stream contains a table like datastructure where each column is called a channel. They are often used to represent data that are sampled on a to high frequencey for use with a vector stream. They are also very usefull to represent lookuptables, calibration curves, reference curves and forecasts that are preiodically reproduced.

From the raw data stream Galore creates a set of different aggregate streams. The type of aggregate produced is different for each stream type:

    - Vector pre aggregates. An aggregate stream is produced for a set of predefined time intervals. The events in these streams are still vector put for each elemement in the raw vector there are three elements in the aggregate vector with the average, min and max value for the interval repectively. The last element of the aggregate vector is a count of the number of events that was aggregated for the interval.

    - State event pre aggregates. An aggregate stream is produced for a set of predefined time intervals. The events in these streams is a special state aggregate type with a count of the number of times a state has been visited and the total duration spent in that time during the aggregate interval. Propageted state events streams are also aggregated in this way (see next item). Note: At the time of writing these aggregate streams does not have a real time.

    - Propagated state events streams. These streams are associated with all nodes in the asset model. A merged stream of all the event streams considered related to this node, useually by beeing a descendant node in the asset model. Multiple propagated streams can be associated with each node if there are different type of state streams related to the node. Typical use of this feature is e.g. to find all alarms events on and asset or to find alarms caused by monitoring other streams.

    - Sampleset preaggregate streams. These streams counts the number of sampleset events in each pre aggregate interval.


